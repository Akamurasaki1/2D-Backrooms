<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Level0</title>
        <!-- <link rel="stylesheet" href="style1.css"> -->
        <style>
            /* 画面上で視認できない戻るボタン */
            .invis-back-btn {
                position: fixed;
                right: 12px;
                bottom: 12px;
                width: 48px;
                height: 48px;
                background: transparent;
                border: none;
                padding: 0;
                margin: 0;
                cursor: pointer;
                opacity: 0;
                cursor: help;
                /* 完全に不可視 */
            }

            /* 下部1/4をハイライトする疑似要素 */
            body::after {
                content: "";
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100%;
                height: 25vh;
                /* 画面下部1/4 */
                pointer-events: none;
                /* クリック等を邪魔しない */
                background: rgba(0, 170, 255, 0);
                /* 初期は透明 */
                z-index: 9999;
                transition: background 200ms ease, opacity 200ms ease;
                opacity: 0;
            }

            /* 属性が付与されたら色を付けてフェードアウトするアニメ */
            @keyframes bottomHighlightFade {
                0% {
                    background: rgba(0, 170, 255, 0.18);
                    opacity: 1;
                }

                70% {
                    background: rgba(0, 170, 255, 0.12);
                    opacity: 1;
                }

                100% {
                    background: rgba(0, 170, 255, 0);
                    opacity: 0;
                }
            }

            :root[data-bottom-clicked="1"]::after {
                animation: bottomHighlightFade 1.8s forwards;
                opacity: 1;
            }

            /* 既存の contextmenu ハンドラ内で、下部クリック検出時に以下2行を追加してください:
               document.documentElement.setAttribute('data-bottom-clicked','1');
               setTimeout(()=>document.documentElement.removeAttribute('data-bottom-clicked'), 1800);
            */
            /* フォーカス時は視認可能にしたい場合は以下を有効化（アクセシビリティ用） */
            .invis-back-btn:focus {
                outline: 2px dashed rgba(125, 211, 252, 0.6);
                opacity: 1;
                background: rgba(125, 211, 252, 0.06);
            }
        </style>
    </head>

    <body>
        <header>
            <h1>2D-Backrooms - Level 0</h1>
        </header>
        <main>
            <section>
                <h2>Level 0: The Lobby</h2>
                <p>これはLevel 0の段落です。ここにLevel 0の説明が表示されます。</p>
                <!-- ↑キー10回または↓キー10回で"Level1.html"に移動 -->
                <!--中央にある線をマウスで10秒以内に5回通過すると"levelminus1.html"へ移動-->
                <!--画面下部1/4の中で10回右クリックすると"Level27.html"に移動-->

                <script>
                    (function () {
                        // --- キー連打での遷移 ---
                        let upCount = 0;
                        let downCount = 0;
                        let keyResetTimer = null;
                        const KEY_RESET_MS = 3000;

                        function resetKeyCounts() {
                            upCount = 0;
                            downCount = 0;
                            if (keyResetTimer) { clearTimeout(keyResetTimer); keyResetTimer = null; }
                        }

                        window.addEventListener('keydown', function (e) {
                            if (e.key === 'ArrowUp') {
                                upCount++;
                                downCount = 0;
                            } else if (e.key === 'ArrowDown') {
                                downCount++;
                                upCount = 0;
                            } else {
                                return;
                            }

                            // リセットタイマー延長
                            if (keyResetTimer) clearTimeout(keyResetTimer);
                            keyResetTimer = setTimeout(resetKeyCounts, KEY_RESET_MS);

                            if (upCount >= 10 || downCount >= 10) {
                                resetKeyCounts();
                                window.location.href = 'Level1.html';
                            }
                        });

                        // --- 中央線通過の検出（縦中央ライン） ---
                        let lastMouseX = null;
                        const centerCrossings = [];
                        const CROSS_WINDOW_MS = 10000; // 10秒間
                        const REQUIRED_CROSSES = 10;

                        function cleanupCrossings() {
                            const now = Date.now();
                            while (centerCrossings.length && (now - centerCrossings[0]) > CROSS_WINDOW_MS) {
                                centerCrossings.shift();
                            }
                        }

                        function onMouseMove(e) {
                            const centerX = window.innerWidth / 2;
                            const x = e.clientX;

                            if (lastMouseX !== null) {
                                // 左から右へ or 右から左へ横切ったか
                                if ((lastMouseX < centerX && x >= centerX) || (lastMouseX > centerX && x <= centerX)) {
                                    centerCrossings.push(Date.now());
                                    cleanupCrossings();
                                    if (centerCrossings.length >= REQUIRED_CROSSES) {
                                        window.removeEventListener('mousemove', onMouseMove);
                                        window.location.href = 'levelminus1.html';
                                        return;
                                    }
                                }
                            }
                            lastMouseX = x;
                        }

                        window.addEventListener('mousemove', onMouseMove);

                        // ウィンドウリサイズ時に lastMouseX をクリア（安全策）
                        window.addEventListener('resize', function () { lastMouseX = null; });

                        // --- 画面下部1/4での右クリックカウント ---
                        let rightClickCount = 0;
                        let rightClickResetTimer = null;
                        const RIGHTCLICK_RESET_MS = 5000; // 5秒でカウントリセット（任意調整）

                        function resetRightClick() {
                            rightClickCount = 0;
                            if (rightClickResetTimer) { clearTimeout(rightClickResetTimer); rightClickResetTimer = null; }
                        }

                        window.addEventListener('contextmenu', function (e) {
                            // 右クリック（通常 button===2）かを確認
                            // contextmenu は通常右クリックで発火するため、ここで判定する
                            const y = e.clientY;
                            const h = window.innerHeight;
                            if (y >= h * 0.75) {
                                e.preventDefault(); // 既定のコンテキストメニューを抑制して連続クリックを扱いやすくする
                                rightClickCount++;
                                if (rightClickResetTimer) clearTimeout(rightClickResetTimer);
                                rightClickResetTimer = setTimeout(resetRightClick, RIGHTCLICK_RESET_MS);

                                if (rightClickCount >= 10) {
                                    resetRightClick();
                                    window.location.href = 'Level27.html';
                                }
                            }
                            // 画面下部外の右クリックは通常どおり動かす（既定処理は上でpreventした場合のみ抑制されます）
                        }, { passive: false });

                    })();
                </script>
            </section>
        </main>
        <!-- 不可視の戻るボタン（クリックで index.html に戻る） -->
        <button class="invis-back-btn" aria-label="トップに戻る" onclick="location.href='index.html'"></button>
        <footer>
            <p>Level 0 wikidot link:<a href="https://backrooms-wiki.wikidot.com/level-0">link</a></p>
            <p>Level 0 Fandom link:<a href="https://backrooms.fandom.com/ja/wiki/Level_0_(1)">link</a></p>
            <p>&copy; A / Murasaki 2025</p>
        </footer>
    </body>

</html>
