<!doctype html>
<html lang="ja">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Backrooms Level Map - HINT(階層一覧はwikidotより。)</title>
        <style>
            :root {
                --bg: #0b0f13;
                --card: #0f1720;
                --accent: #7dd3fc;
                --muted: #94a3b8
            }

            html,
            body {
                height: 100%;
                margin: 0;
                font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
                background: linear-gradient(180deg, #040609 0%, #071019 100%);
                color: #e6eef6
            }

            .wrap {
                display: flex;
                gap: 16px;
                padding: 20px;
                box-sizing: border-box;
                height: 100%
            }

            .map {
                flex: 1;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 8px;
                padding: 12px;
                position: relative;
                min-width: 320px
            }

            svg {
                width: 100%;
                height: 100%
            }

            .panel {
                width: 300px;
                background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
                border-radius: 8px;
                padding: 12px;
                box-sizing: border-box;
                overflow: auto
            }

            h1 {
                font-size: 16px;
                margin: 0 0 8px 0
            }

            .legend {
                font-size: 13px;
                color: var(--muted);
                margin-bottom: 8px
            }

            .node {
                cursor: pointer
            }

            .node circle {
                fill: var(--card);
                stroke: var(--muted);
                stroke-width: 1.5
            }

            .node text {
                pointer-events: none;
                fill: #e6eef6;
                font-size: 12px
            }

            .edge {
                stroke: rgba(125, 211, 252, 0.25);
                stroke-width: 2;
                marker-end: url(#arrow)
            }

            .edge.highlight {
                stroke: var(--accent);
                stroke-width: 3;
                opacity: 1
            }

            .node.highlight circle {
                stroke: var(--accent);
                stroke-width: 2.5;
                fill: rgba(125, 211, 252, 0.06)
            }

            .list {
                font-size: 13px;
                color: #dbeafe;
                margin: 0;
                padding: 0;
                list-style: none
            }

            .list li {
                padding: 6px 8px;
                border-radius: 6px;
                margin-bottom: 6px;
                background: rgba(255, 255, 255, 0.02);
                display: flex;
                justify-content: space-between;
                align-items: center
            }

            .list li .reason {
                font-size: 12px;
                color: var(--muted);
                margin-left: 8px;
            }

            .hint {
                font-size: 13px;
                color: var(--muted);
                margin-top: 8px
            }

            .btn {
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.04);
                color: #dbeafe;
                padding: 6px 8px;
                border-radius: 6px;
                cursor: pointer
            }

            .btn:active {
                transform: translateY(1px)
            }

            .footer {
                margin-top: 10px;
                font-size: 12px;
                color: var(--muted)
            }

            .tooltip {
                position: absolute;
                background: #031524;
                border: 1px solid rgba(125, 211, 252, 0.12);
                padding: 6px 8px;
                border-radius: 6px;
                color: #cfeefd;
                font-size: 13px;
                pointer-events: none;
                transform: translate(-50%, -120%);
                white-space: nowrap;
                display: none
            }
        </style>
    </head>

    <body>
        <div class="wrap">
            <div class="map" id="map">
                <svg id="svgmap" viewBox="0 0 1000 700" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto"
                            markerUnits="strokeWidth">
                            <path d="M0,0 L10,5 L0,10 z" fill="#7dd3fc" />
                        </marker>
                    </defs>
                    <!-- edges and nodes injected by script -->
                </svg>
                <div class="tooltip" id="tooltip"></div>
            </div>

            <div class="panel">
                <h1>接続ヒントマップ</h1>
                <div class="legend">ノードをクリック/ホバーすると、そのLevelから繋がる先をハイライトします。</div>

                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                    <button class="btn" id="shuffle">配置をランダム</button>
                    <button class="btn" id="reset">リセット表示</button>
                </div>

                <strong>接続一覧</strong>
                <ul class="list" id="linkList"></ul>

                <div class="hint">
                    ※ データは下部のスクリプトで編集できます。Level名・接続を追加してマップを作成してください。
                </div>
                <div class="footer">HINT.html — Backrooms Map</div>
            </div>
        </div>

        <script>
            /* --- ここを編集してLevelと接続を定義 --- */
            const levels = [
                { id: "Front Room", name: "Front Room" },
                { id: "L0", name: "Level 0" },
                { id: "L1", name: "Level 1" },
                { id: "L2", name: "Level 2" },
                { id: "L3", name: "Level 3" },
                { id: "L4", name: "Level 4" },
                { id: "L5", name: "Level 5" },
                { id: "L6", name: "Level 6" },
                { id: "L7", name: "Level 7" },
                { id: "L9", name: "Level 9" },
                { id: "L10", name: "Level 10" },
                { id: "L11", name: "Level 11" },
                { id: "L12", name: "Level 12" },
                { id: "L13", name: "Level 13" },
                { id: "L14", name: "Level 14" },
                { id: "L15", name: "Level 15" },
                { id: "L16", name: "Level 16" },
                { id: "L17", name: "Level 17" },
                { id: "L18", name: "Level 18" },
                { id: "L19", name: "Level 19" },
                { id: "L20", name: "Level 20" },
                { id: "L21", name: "Level 21" },
                { id: "L22", name: "Level 22" },
                { id: "L23", name: "Level 23" },
                { id: "L24", name: "Level 24" },
                { id: "L25", name: "Level 25" },
                { id: "L26", name: "Level 26" },
                { id: "L27", name: "Level 27" },
                { id: "L28", name: "Level 28" },
                { id: "L29", name: "Level 29" },
                { id: "L30", name: "Level 30" },
                { id: "L31", name: "Level 31" },
                { id: "L32", name: "Level 32" },
                { id: "L33", name: "Level 33" },
                { id: "L34", name: "Level 34" },
                { id: "L35", name: "Level 35" },
                { id: "L36", name: "Level 36" },
                { id: "L37", name: "Level 37" },
                { id: "L38", name: "Level 38" },
                { id: "L39", name: "Level 39" },
                { id: "L40", name: "Level 40" },
                { id: "L41", name: "Level 41" },
                { id: "L42", name: "Level 42" },
                { id: "L43", name: "Level 43" },
                { id: "L44", name: "Level 44" },
                { id: "L45", name: "Level 45" },
                { id: "L46", name: "Level 46" },
                { id: "L47", name: "Level 47" },
                { id: "L48", name: "Level 48" },
                { id: "L49", name: "Level 49" },
                { id: "L50", name: "Level 50" },
                { id: "L51", name: "Level 51" },
                { id: "L52", name: "Level 52" },
                { id: "L53", name: "Level 53" },
                { id: "L54", name: "Level 54" },
                { id: "L55", name: "Level 55" },
                { id: "L56", name: "Level 56" },
                { id: "L57", name: "Level 57" },
                { id: "L58", name: "Level 58" },
                { id: "L59", name: "Level 59" },
                { id: "L60", name: "Level 60" },
                { id: "L61", name: "Level 61" },
                { id: "L62", name: "Level 62" },
                { id: "L63", name: "Level 63" },
                { id: "L64", name: "Level 64" },
                { id: "L65", name: "Level 65" },
                { id: "L66", name: "Level 66" },
                { id: "L67", name: "Level 67" },
                { id: "L68", name: "Level 68" },
                { id: "L69", name: "Level 69" },
                { id: "L70", name: "Level 70" },
                { id: "L71", name: "Level 71" },
                { id: "L72", name: "Level 72" },
                { id: "L73", name: "Level 73" },
                { id: "L74", name: "Level 74" },
                { id: "L75", name: "Level 75" },
                { id: "L76", name: "Level 76" },
                { id: "L77", name: "Level 77" },
                { id: "L78", name: "Level 78" },
                { id: "L79", name: "Level 79" },
                { id: "L80", name: "Level 80" },
                { id: "L81", name: "Level 81" },
                { id: "L82", name: "Level 82" },
                { id: "L83", name: "Level 83" },
                { id: "L84", name: "Level 84" },
                { id: "L85", name: "Level 85" },
                { id: "L86", name: "Level 86" },
                { id: "L87", name: "Level 87" },
                { id: "L88", name: "Level 88" },
                { id: "L89", name: "Level 89" },
                { id: "L90", name: "Level 90" },
                { id: "L91", name: "Level 91" },
                { id: "L92", name: "Level 92" },
                { id: "L93", name: "Level 93" },
                { id: "L94", name: "Level 94" },
                { id: "L95", name: "Level 95" },
                { id: "L96", name: "Level 96" },
                { id: "L97", name: "Level 97" },
                { id: "L98", name: "Level 98" },
                { id: "L99", name: "Level 99" },
                { id: "L100", name: "Level 100" },
                { id: "L101", name: "Level 101" },
                { id: "L102", name: "Level 102" },
                { id: "L103", name: "Level 103" },
                { id: "L104", name: "Level 104" },
                { id: "L105", name: "Level 105" },
                { id: "L106", name: "Level 106" },
                { id: "L107", name: "Level 107" },
                { id: "L108", name: "Level 108" },
                { id: "L109", name: "Level 109" },
                { id: "L110", name: "Level 110" },
                { id: "L111", name: "Level 111" },
                { id: "L112", name: "Level 112" },
                { id: "L113", name: "Level 113" },
                { id: "L114", name: "Level 114" },
                { id: "L115", name: "Level 115" },
                { id: "L116", name: "Level 116" },
                { id: "L117", name: "Level 117" },
                { id: "L118", name: "Level 118" },
                { id: "L119", name: "Level 119" },
                { id: "L120", name: "Level 120" },
                { id: "L121", name: "Level 121" },
                { id: "L122", name: "Level 122" },
                { id: "L123", name: "Level 123" },
                { id: "L124", name: "Level 124" },
                { id: "L125", name: "Level 125" },
                { id: "L126", name: "Level 126" },
                { id: "L127", name: "Level 127" },
                { id: "L128", name: "Level 128" },
                { id: "L129", name: "Level 129" },
                { id: "L130", name: "Level 130" },
                { id: "L131", name: "Level 131" },
                { id: "L132", name: "Level 132" },
                { id: "L133", name: "Level 133" },
                { id: "L134", name: "Level 134" },
                { id: "L135", name: "Level 135" },
                { id: "L136", name: "Level 136" },
                { id: "L137", name: "Level 137" },
                { id: "L138", name: "Level 138" },
                { id: "L139", name: "Level 139" },
                { id: "L140", name: "Level 140" },
                { id: "L141", name: "Level 141" },
                { id: "L142", name: "Level 142" },
                { id: "L143", name: "Level 143" },
                { id: "L144", name: "Level 144" },
                { id: "L145", name: "Level 145" },
                { id: "L146", name: "Level 146" },
                { id: "L147", name: "Level 147" },
                { id: "L148", name: "Level 148" },
                { id: "L149", name: "Level 149" },
                { id: "L150", name: "Level 150" },
                { id: "L151", name: "Level 151" },
                { id: "L152", name: "Level 152" },
                { id: "L153", name: "Level 153" },
                { id: "L154", name: "Level 154" },
                { id: "L155", name: "Level 155" },
                { id: "L156", name: "Level 156" },
                { id: "L157", name: "Level 157" },
                { id: "L158", name: "Level 158" },
                { id: "L159", name: "Level 159" },
                { id: "L160", name: "Level 160" },
                { id: "L161", name: "Level 161" },
                { id: "L162", name: "Level 162" },
                { id: "L163", name: "Level 163" },
                { id: "L164", name: "Level 164" },
                { id: "L165", name: "Level 165" },
                { id: "L166", name: "Level 166" },
                { id: "L167", name: "Level 167" },
                { id: "L168", name: "Level 168" },
                { id: "L169", name: "Level 169" },
                { id: "L170", name: "Level 170" },
                { id: "L171", name: "Level 171" },
                { id: "L172", name: "Level 172" },
                { id: "L173", name: "Level 173" },
                { id: "L174", name: "Level 174" },
                { id: "L175", name: "Level 175" },
                { id: "L176", name: "Level 176" },
                { id: "L177", name: "Level 177" },
                { id: "L178", name: "Level 178" },
                { id: "L179", name: "Level 179" },
                { id: "L180", name: "Level 180" },
                { id: "L181", name: "Level 181" },
                { id: "L182", name: "Level 182" },
                { id: "L183", name: "Level 183" },
                { id: "L184", name: "Level 184" },
                { id: "L185", name: "Level 185" },
                { id: "L186", name: "Level 186" },
                { id: "L187", name: "Level 187" },
                { id: "L188", name: "Level 188" },
                { id: "L189", name: "Level 189" },
                { id: "L190", name: "Level 190" },
                { id: "L191", name: "Level 191" },
                { id: "L192", name: "Level 192" },
                { id: "L193", name: "Level 193" },
                { id: "L194", name: "Level 194" },
                { id: "L195", name: "Level 195" },
                { id: "L196", name: "Level 196" },
                { id: "L197", name: "Level 197" },
                { id: "L198", name: "Level 198" },
                { id: "L199", name: "Level 199" },
                { id: "L200", name: "Level 200" },
                { id: "L201", name: "Level 201" },
                { id: "L202", name: "Level 202" },
                { id: "L203", name: "Level 203" },
                { id: "L204", name: "Level 204" },
                { id: "L205", name: "Level 205" },
                { id: "L206", name: "Level 206" },
                { id: "L207", name: "Level 207" },
                { id: "L208", name: "Level 208" },
                { id: "L209", name: "Level 209" },
                { id: "L210", name: "Level 210" },
                { id: "L211", name: "Level 211" },
                { id: "L212", name: "Level 212" },
                { id: "L213", name: "Level 213" },
                { id: "L214", name: "Level 214" },
                { id: "L215", name: "Level 215" },
                { id: "L216", name: "Level 216" },
                { id: "L217", name: "Level 217" },
                { id: "L218", name: "Level 218" },
                { id: "L219", name: "Level 219" },
                { id: "L220", name: "Level 220" },
                { id: "L221", name: "Level 221" },
                { id: "L222", name: "Level 222" },
                { id: "L223", name: "Level 223" },
                { id: "L224", name: "Level 224" },
                { id: "L225", name: "Level 225" },
                { id: "L226", name: "Level 226" },
                { id: "L227", name: "Level 227" },
                { id: "L228", name: "Level 228" },
                { id: "L229", name: "Level 229" },
                { id: "L230", name: "Level 230" },
                { id: "L231", name: "Level 231" },
                { id: "L232", name: "Level 232" },
                { id: "L233", name: "Level 233" },
                { id: "L234", name: "Level 234" },
                { id: "L235", name: "Level 235" },
                { id: "L236", name: "Level 236" },
                { id: "L237", name: "Level 237" },
                { id: "L238", name: "Level 238" },
                { id: "L239", name: "Level 239" },
                { id: "L240", name: "Level 240" },
                { id: "L241", name: "Level 241" },
                { id: "L242", name: "Level 242" },
                { id: "L243", name: "Level 243" },
                { id: "L244", name: "Level 244" },
                { id: "L245", name: "Level 245" },
                { id: "L246", name: "Level 246" },
                { id: "L247", name: "Level 247" },
                { id: "L248", name: "Level 248" },
                { id: "L249", name: "Level 249" },
                { id: "L250", name: "Level 250" },
                { id: "L251", name: "Level 251" },
                { id: "L252", name: "Level 252" },
                { id: "L253", name: "Level 253" },
                { id: "L254", name: "Level 254" },
                { id: "L255", name: "Level 255" },
                { id: "L256", name: "Level 256" },
                { id: "L257", name: "Level 257" },
                { id: "L258", name: "Level 258" },
                { id: "L259", name: "Level 259" },
                { id: "L260", name: "Level 260" },
                { id: "L261", name: "Level 261" },
                { id: "L262", name: "Level 262" },
                { id: "L263", name: "Level 263" },
                { id: "L264", name: "Level 264" },
                { id: "L265", name: "Level 265" },
                { id: "L266", name: "Level 266" },
                { id: "L267", name: "Level 267" },
                { id: "L268", name: "Level 268" },
                { id: "L269", name: "Level 269" },
                { id: "L270", name: "Level 270" },
                { id: "L271", name: "Level 271" },
                { id: "L272", name: "Level 272" },
                { id: "L273", name: "Level 273" },
                { id: "L274", name: "Level 274" },
                { id: "L275", name: "Level 275" },
                { id: "L276", name: "Level 276" },
                { id: "L277", name: "Level 277" },
                { id: "L278", name: "Level 278" },
                { id: "L279", name: "Level 279" },
                { id: "L280", name: "Level 280" },
                { id: "L281", name: "Level 281" },
                { id: "L282", name: "Level 282" },
                { id: "L283", name: "Level 283" },
                { id: "L284", name: "Level 284" },
                { id: "L285", name: "Level 285" },
                { id: "L286", name: "Level 286" },
                { id: "L287", name: "Level 287" },
                { id: "L288", name: "Level 288" },
                { id: "L289", name: "Level 289" },
                { id: "L290", name: "Level 290" },
                { id: "L291", name: "Level 291" },
                { id: "L292", name: "Level 292" },
                { id: "L293", name: "Level 293" },
                { id: "L294", name: "Level 294" },
                { id: "L295", name: "Level 295" },
                { id: "L296", name: "Level 296" },
                { id: "L297", name: "Level 297" },
                { id: "L298", name: "Level 298" },
                { id: "L299", name: "Level 299" },
                { id: "L300", name: "Level 300" },
                { id: "L301", name: "Level 301" },
                { id: "L302", name: "Level 302" },
                { id: "L303", name: "Level 303" },
                { id: "L304", name: "Level 304" },
                { id: "L305", name: "Level 305" },
                { id: "L306", name: "Level 306" },
                { id: "L307", name: "Level 307" },
                { id: "L308", name: "Level 308" },
                { id: "L309", name: "Level 309" },
                { id: "L310", name: "Level 310" },
                { id: "L311", name: "Level 311" },
                { id: "L312", name: "Level 312" },
                { id: "L313", name: "Level 313" },
                { id: "L314", name: "Level 314" },
                { id: "L315", name: "Level 315" },
                { id: "L316", name: "Level 316" },
                { id: "L317", name: "Level 317" },
                { id: "L318", name: "Level 318" },
                { id: "L319", name: "Level 319" },
                { id: "L320", name: "Level 320" },
                { id: "L321", name: "Level 321" },
                { id: "L322", name: "Level 322" },
                { id: "L323", name: "Level 323" },
                { id: "L324", name: "Level 324" },
                { id: "L325", name: "Level 325" },
                { id: "L326", name: "Level 326" },
                { id: "L327", name: "Level 327" },
                { id: "L328", name: "Level 328" },
                { id: "L329", name: "Level 329" },
                { id: "L330", name: "Level 330" },
                { id: "L331", name: "Level 331" },
                { id: "L332", name: "Level 332" },
                { id: "L333", name: "Level 333" },
                { id: "L334", name: "Level 334" },
                { id: "L335", name: "Level 335" },
                { id: "L336", name: "Level 336" },
                { id: "L337", name: "Level 337" },
                { id: "L338", name: "Level 338" },
                { id: "L339", name: "Level 339" },
                { id: "L340", name: "Level 340" },
                { id: "L341", name: "Level 341" },
                { id: "L342", name: "Level 342" },
                { id: "L343", name: "Level 343" },
                { id: "L344", name: "Level 344" },
                { id: "L345", name: "Level 345" },
                { id: "L346", name: "Level 346" },
                { id: "L347", name: "Level 347" },
                { id: "L348", name: "Level 348" },
                { id: "L349", name: "Level 349" },
                { id: "L350", name: "Level 350" },
                { id: "L351", name: "Level 351" },
                { id: "L352", name: "Level 352" },
                { id: "L353", name: "Level 353" },
                { id: "L354", name: "Level 354" },
                { id: "L355", name: "Level 355" },
                { id: "L356", name: "Level 356" },
                { id: "L357", name: "Level 357" },
                { id: "L358", name: "Level 358" },
                { id: "L359", name: "Level 359" },
                { id: "L360", name: "Level 360" },
                { id: "L361", name: "Level 361" },
                { id: "L362", name: "Level 362" },
                { id: "L363", name: "Level 363" },
                { id: "L364", name: "Level 364" },
                { id: "L365", name: "Level 365" },
                { id: "L366", name: "Level 366" },
                { id: "L367", name: "Level 367" },
                { id: "L368", name: "Level 368" },
                { id: "L369", name: "Level 369" },
                { id: "L370", name: "Level 370" },
                { id: "L371", name: "Level 371" },
                { id: "L372", name: "Level 372" },
                { id: "L373", name: "Level 373" },
                { id: "L374", name: "Level 374" },
                { id: "L375", name: "Level 375" },
                { id: "L376", name: "Level 376" },
                { id: "L377", name: "Level 377" },
                { id: "L378", name: "Level 378" },
                { id: "L379", name: "Level 379" },
                { id: "L380", name: "Level 380" },
                { id: "L381", name: "Level 381" },
                { id: "L382", name: "Level 382" },
                { id: "L383", name: "Level 383" },
                { id: "L384", name: "Level 384" },
                { id: "L385", name: "Level 385" },
                { id: "L386", name: "Level 386" },
                { id: "L387", name: "Level 387" },
                { id: "L388", name: "Level 388" },
                { id: "L389", name: "Level 389" },
                { id: "L390", name: "Level 390" },
                { id: "L391", name: "Level 391" },
                { id: "L392", name: "Level 392" },
                { id: "L393", name: "Level 393" },
                { id: "L394", name: "Level 394" },
                { id: "L395", name: "Level 395" },
                { id: "L396", name: "Level 396" },
                { id: "L397", name: "Level 397" },
                { id: "L398", name: "Level 398" },
                { id: "L399", name: "Level 399" },
                { id: "L400", name: "Level 400" },
                { id: "L401", name: "Level 401" },
                { id: "L402", name: "Level 402" },
                { id: "L403", name: "Level 403" },
                { id: "L404", name: "Level 404" },
                { id: "L405", name: "Level 405" },
                { id: "L406", name: "Level 406" },
                { id: "L407", name: "Level 407" },
                { id: "L408", name: "Level 408" },
                { id: "L409", name: "Level 409" },
                { id: "L410", name: "Level 410" },
                { id: "L411", name: "Level 411" },
                { id: "L412", name: "Level 412" },
                { id: "L413", name: "Level 413" },
                { id: "L414", name: "Level 414" },
                { id: "L415", name: "Level 415" },
                { id: "L416", name: "Level 416" },
                { id: "L417", name: "Level 417" },
                { id: "L418", name: "Level 418" },
                { id: "L419", name: "Level 419" },
                { id: "L420", name: "Level 420" },
                { id: "L421", name: "Level 421" },
                { id: "L422", name: "Level 422" },
                { id: "L423", name: "Level 423" },
                { id: "L424", name: "Level 424" },
                { id: "L425", name: "Level 425" },
                { id: "L426", name: "Level 426" },
                { id: "L427", name: "Level 427" },
                { id: "L428", name: "Level 428" },
                { id: "L429", name: "Level 429" },
                { id: "L430", name: "Level 430" },
                { id: "L431", name: "Level 431" },
                { id: "L432", name: "Level 432" },
                { id: "L433", name: "Level 433" },
                { id: "L434", name: "Level 434" },
                { id: "L435", name: "Level 435" },
                { id: "L436", name: "Level 436" },
                { id: "L437", name: "Level 437" },
                { id: "L438", name: "Level 438" },
                { id: "L439", name: "Level 439" },
                { id: "L440", name: "Level 440" },
                { id: "L441", name: "Level 441" },
                { id: "L442", name: "Level 442" },
                { id: "L443", name: "Level 443" },
                { id: "L444", name: "Level 444" },
                { id: "L445", name: "Level 445" },
                { id: "L446", name: "Level 446" },
                { id: "L447", name: "Level 447" },
                { id: "L448", name: "Level 448" },
                { id: "L449", name: "Level 449" },
                { id: "L450", name: "Level 450" },
                { id: "L451", name: "Level 451" },
                { id: "L452", name: "Level 452" },
                { id: "L453", name: "Level 453" },
                { id: "L454", name: "Level 454" },
                { id: "L455", name: "Level 455" },
                { id: "L456", name: "Level 456" },
                { id: "L457", name: "Level 457" },
                { id: "L458", name: "Level 458" },
                { id: "L459", name: "Level 459" },
                { id: "L460", name: "Level 460" },
                { id: "L461", name: "Level 461" },
                { id: "L462", name: "Level 462" },
                { id: "L463", name: "Level 463" },
                { id: "L464", name: "Level 464" },
                { id: "L465", name: "Level 465" },
                { id: "L466", name: "Level 466" },
                { id: "L467", name: "Level 467" },
                { id: "L468", name: "Level 468" },
                { id: "L469", name: "Level 469" },
                { id: "L470", name: "Level 470" },
                { id: "L471", name: "Level 471" },
                { id: "L472", name: "Level 472" },
                { id: "L473", name: "Level 473" },
                { id: "L474", name: "Level 474" },
                { id: "L475", name: "Level 475" },
                { id: "L476", name: "Level 476" },
                { id: "L477", name: "Level 477" },
                { id: "L478", name: "Level 478" },
                { id: "L479", name: "Level 479" },
                { id: "L480", name: "Level 480" },
                { id: "L481", name: "Level 481" },
                { id: "L482", name: "Level 482" },
                { id: "L483", name: "Level 483" },
                { id: "L484", name: "Level 484" },
                { id: "L485", name: "Level 485" },
                { id: "L486", name: "Level 486" },
                { id: "L487", name: "Level 487" },
                { id: "L488", name: "Level 488" },
                { id: "L489", name: "Level 489" },
                { id: "L490", name: "Level 490" },
                { id: "L491", name: "Level 491" },
                { id: "L492", name: "Level 492" },
                { id: "L493", name: "Level 493" },
                { id: "L494", name: "Level 494" },
                { id: "L495", name: "Level 495" },
                { id: "L496", name: "Level 496" },
                { id: "L497", name: "Level 497" },
                { id: "L498", name: "Level 498" },
                { id: "L499", name: "Level 499" },
                { id: "L500", name: "Level 500" },
                { id: "L501", name: "Level 501" },
                { id: "L502", name: "Level 502" },
                { id: "L503", name: "Level 503" },
                { id: "L504", name: "Level 504" },
                { id: "L505", name: "Level 505" },
                { id: "L506", name: "Level 506" },
                { id: "L507", name: "Level 507" },
                { id: "L508", name: "Level 508" },
                { id: "L509", name: "Level 509" },
                { id: "L510", name: "Level 510" },
                { id: "L511", name: "Level 511" },
                { id: "L512", name: "Level 512" },
                { id: "L513", name: "Level 513" },
                { id: "L514", name: "Level 514" },
                { id: "L515", name: "Level 515" },
                { id: "L516", name: "Level 516" },
                { id: "L517", name: "Level 517" },
                { id: "L518", name: "Level 518" },
                { id: "L519", name: "Level 519" },
                { id: "L520", name: "Level 520" },
                { id: "L521", name: "Level 521" },
                { id: "L522", name: "Level 522" },
                { id: "L523", name: "Level 523" },
                { id: "L524", name: "Level 524" },
                { id: "L525", name: "Level 525" },
                { id: "L526", name: "Level 526" },
                { id: "L527", name: "Level 527" },
                { id: "L528", name: "Level 528" },
                { id: "L529", name: "Level 529" },
                { id: "L530", name: "Level 530" },
                { id: "L531", name: "Level 531" },
                { id: "L532", name: "Level 532" },
                { id: "L533", name: "Level 533" },
                { id: "L534", name: "Level 534" },
                { id: "L535", name: "Level 535" },
                { id: "L536", name: "Level 536" },
                { id: "L537", name: "Level 537" },
                { id: "L538", name: "Level 538" },
                { id: "L539", name: "Level 539" },
                { id: "L540", name: "Level 540" },
                { id: "L541", name: "Level 541" },
                { id: "L542", name: "Level 542" },
                { id: "L543", name: "Level 543" },
                { id: "L544", name: "Level 544" },
                { id: "L545", name: "Level 545" },
                { id: "L546", name: "Level 546" },
                { id: "L547", name: "Level 547" },
                { id: "L548", name: "Level 548" },
                { id: "L549", name: "Level 549" },
                { id: "L550", name: "Level 550" },
                { id: "L551", name: "Level 551" },
                { id: "L552", name: "Level 552" },
                { id: "L553", name: "Level 553" },
                { id: "L554", name: "Level 554" },
                { id: "L555", name: "Level 555" },
                { id: "L556", name: "Level 556" },
                { id: "L557", name: "Level 557" },
                { id: "L558", name: "Level 558" },
                { id: "L559", name: "Level 559" },
                { id: "L560", name: "Level 560" },
                { id: "L561", name: "Level 561" },
                { id: "L562", name: "Level 562" },
                { id: "L563", name: "Level 563" },
                { id: "L564", name: "Level 564" },
                { id: "L565", name: "Level 565" },
                { id: "L566", name: "Level 566" },
                { id: "L567", name: "Level 567" },
                { id: "L568", name: "Level 568" },
                { id: "L569", name: "Level 569" },
                { id: "L570", name: "Level 570" },
                { id: "L571", name: "Level 571" },
                { id: "L572", name: "Level 572" },
                { id: "L573", name: "Level 573" },
                { id: "L574", name: "Level 574" },
                { id: "L575", name: "Level 575" },
                { id: "L576", name: "Level 576" },
                { id: "L577", name: "Level 577" },
                { id: "L578", name: "Level 578" },
                { id: "L579", name: "Level 579" },
                { id: "L580", name: "Level 580" },
                { id: "L581", name: "Level 581" },
                { id: "L582", name: "Level 582" },
                { id: "L583", name: "Level 583" },
                { id: "L584", name: "Level 584" },
                { id: "L585", name: "Level 585" },
                { id: "L586", name: "Level 586" },
                { id: "L587", name: "Level 587" },
                { id: "L588", name: "Level 588" },
                { id: "L589", name: "Level 589" },
                { id: "L590", name: "Level 590" },
                { id: "L591", name: "Level 591" },
                { id: "L592", name: "Level 592" },
                { id: "L593", name: "Level 593" },
                { id: "L594", name: "Level 594" },
                { id: "L595", name: "Level 595" },
                { id: "L596", name: "Level 596" },
                { id: "L597", name: "Level 597" },
                { id: "L598", name: "Level 598" },
                { id: "L599", name: "Level 599" },
                { id: "L600", name: "Level 600" },
                { id: "L601", name: "Level 601" },
                { id: "L602", name: "Level 602" },
                { id: "L603", name: "Level 603" },
                { id: "L604", name: "Level 604" },
                { id: "L605", name: "Level 605" },
                { id: "L606", name: "Level 606" },
                { id: "L607", name: "Level 607" },
                { id: "L608", name: "Level 608" },
                { id: "L609", name: "Level 609" },
                { id: "L610", name: "Level 610" },
                { id: "L611", name: "Level 611" },
                { id: "L612", name: "Level 612" },
                { id: "L613", name: "Level 613" },
                { id: "L614", name: "Level 614" },
                { id: "L615", name: "Level 615" },
                { id: "L616", name: "Level 616" },
                { id: "L617", name: "Level 617" },
                { id: "L618", name: "Level 618" },
                { id: "L619", name: "Level 619" },
                { id: "L620", name: "Level 620" },
                { id: "L621", name: "Level 621" },
                { id: "L622", name: "Level 622" },
                { id: "L623", name: "Level 623" },
                { id: "L624", name: "Level 624" },
                { id: "L625", name: "Level 625" },
                { id: "L626", name: "Level 626" },
                { id: "L627", name: "Level 627" },
                { id: "L628", name: "Level 628" },
                { id: "L629", name: "Level 629" },
                { id: "L630", name: "Level 630" },
                { id: "L631", name: "Level 631" },
                { id: "L632", name: "Level 632" },
                { id: "L633", name: "Level 633" },
                { id: "L634", name: "Level 634" },
                { id: "L635", name: "Level 635" },
                { id: "L636", name: "Level 636" },
                { id: "L637", name: "Level 637" },
                { id: "L638", name: "Level 638" },
                { id: "L639", name: "Level 639" },
                { id: "L640", name: "Level 640" },
                { id: "L641", name: "Level 641" },
                { id: "L642", name: "Level 642" },
                { id: "L643", name: "Level 643" },
                { id: "L644", name: "Level 644" },
                { id: "L645", name: "Level 645" },
                { id: "L646", name: "Level 646" },
                { id: "L647", name: "Level 647" },
                { id: "L648", name: "Level 648" },
                { id: "L649", name: "Level 649" },
                { id: "L650", name: "Level 650" },
                { id: "L651", name: "Level 651" },
                { id: "L652", name: "Level 652" },
                { id: "L653", name: "Level 653" },
                { id: "L654", name: "Level 654" },
                { id: "L655", name: "Level 655" },
                { id: "L656", name: "Level 656" },
                { id: "L657", name: "Level 657" },
                { id: "L658", name: "Level 658" },
                { id: "L659", name: "Level 659" },
                { id: "L660", name: "Level 660" },
                { id: "L661", name: "Level 661" },
                { id: "L662", name: "Level 662" },
                { id: "L663", name: "Level 663" },
                { id: "L664", name: "Level 664" },
                { id: "L665", name: "Level 665" },
                { id: "L666", name: "Level 666" },
                { id: "L667", name: "Level 667" },
                { id: "L668", name: "Level 668" },
                { id: "L669", name: "Level 669" },
                { id: "L670", name: "Level 670" },
                { id: "L671", name: "Level 671" },
                { id: "L672", name: "Level 672" },
                { id: "L673", name: "Level 673" },
                { id: "L674", name: "Level 674" },
                { id: "L675", name: "Level 675" },
                { id: "L676", name: "Level 676" },
                { id: "L677", name: "Level 677" },
                { id: "L678", name: "Level 678" },
                { id: "L679", name: "Level 679" },
                { id: "L680", name: "Level 680" },
                { id: "L681", name: "Level 681" },
                { id: "L682", name: "Level 682" },
                { id: "L683", name: "Level 683" },
                { id: "L684", name: "Level 684" },
                { id: "L685", name: "Level 685" },
                { id: "L686", name: "Level 686" },
                { id: "L687", name: "Level 687" },
                { id: "L688", name: "Level 688" },
                { id: "L689", name: "Level 689" },
                { id: "L690", name: "Level 690" },
                { id: "L691", name: "Level 691" },
                { id: "L692", name: "Level 692" },
                { id: "L693", name: "Level 693" },
                { id: "L694", name: "Level 694" },
                { id: "L695", name: "Level 695" },
                { id: "L696", name: "Level 696" },
                { id: "L697", name: "Level 697" },
                { id: "L698", name: "Level 698" },
                { id: "L699", name: "Level 699" },
                { id: "L700", name: "Level 700" },
                { id: "L701", name: "Level 701" },
                { id: "L702", name: "Level 702" },
                { id: "L703", name: "Level 703" },
                { id: "L704", name: "Level 704" },
                { id: "L705", name: "Level 705" },
                { id: "L706", name: "Level 706" },
                { id: "L707", name: "Level 707" },
                { id: "L708", name: "Level 708" },
                { id: "L709", name: "Level 709" },
                { id: "L710", name: "Level 710" },
                { id: "L711", name: "Level 711" },
                { id: "L712", name: "Level 712" },
                { id: "L713", name: "Level 713" },
                { id: "L714", name: "Level 714" },
                { id: "L715", name: "Level 715" },
                { id: "L716", name: "Level 716" },
                { id: "L717", name: "Level 717" },
                { id: "L718", name: "Level 718" },
                { id: "L719", name: "Level 719" },
                { id: "L720", name: "Level 720" },
                { id: "L721", name: "Level 721" },
                { id: "L722", name: "Level 722" },
                { id: "L723", name: "Level 723" },
                { id: "L724", name: "Level 724" },
                { id: "L725", name: "Level 725" },
                { id: "L726", name: "Level 726" },
                { id: "L727", name: "Level 727" },
                { id: "L728", name: "Level 728" },
                { id: "L729", name: "Level 729" },
                { id: "L730", name: "Level 730" },
                { id: "L731", name: "Level 731" },
                { id: "L732", name: "Level 732" },
                { id: "L733", name: "Level 733" },
                { id: "L734", name: "Level 734" },
                { id: "L735", name: "Level 735" },
                { id: "L736", name: "Level 736" },
                { id: "L737", name: "Level 737" },
                { id: "L738", name: "Level 738" },
                { id: "L739", name: "Level 739" },
                { id: "L740", name: "Level 740" },
                { id: "L741", name: "Level 741" },
                { id: "L742", name: "Level 742" },
                { id: "L743", name: "Level 743" },
                { id: "L744", name: "Level 744" },
                { id: "L745", name: "Level 745" },
                { id: "L746", name: "Level 746" },
                { id: "L747", name: "Level 747" },
                { id: "L748", name: "Level 748" },
                { id: "L749", name: "Level 749" },
                { id: "L750", name: "Level 750" },
                { id: "L751", name: "Level 751" },
                { id: "L752", name: "Level 752" },
                { id: "L753", name: "Level 753" },
                { id: "L754", name: "Level 754" },
                { id: "L755", name: "Level 755" },
                { id: "L756", name: "Level 756" },
                { id: "L757", name: "Level 757" },
                { id: "L758", name: "Level 758" },
                { id: "L759", name: "Level 759" },
                { id: "L760", name: "Level 760" },
                { id: "L761", name: "Level 761" },
                { id: "L762", name: "Level 762" },
                { id: "L763", name: "Level 763" },
                { id: "L764", name: "Level 764" },
                { id: "L765", name: "Level 765" },
                { id: "L766", name: "Level 766" },
                { id: "L767", name: "Level 767" },
                { id: "L768", name: "Level 768" },
                { id: "L769", name: "Level 769" },
                { id: "L770", name: "Level 770" },
                { id: "L771", name: "Level 771" },
                { id: "L772", name: "Level 772" },
                { id: "L773", name: "Level 773" },
                { id: "L774", name: "Level 774" },
                { id: "L775", name: "Level 775" },
                { id: "L776", name: "Level 776" },
                { id: "L777", name: "Level 777" },
                { id: "L778", name: "Level 778" },
                { id: "L779", name: "Level 779" },
                { id: "L780", name: "Level 780" },
                { id: "L781", name: "Level 781" },
                { id: "L782", name: "Level 782" },
                { id: "L783", name: "Level 783" },
                { id: "L784", name: "Level 784" },
                { id: "L785", name: "Level 785" },
                { id: "L786", name: "Level 786" },
                { id: "L787", name: "Level 787" },
                { id: "L788", name: "Level 788" },
                { id: "L789", name: "Level 789" },
                { id: "L790", name: "Level 790" },
                { id: "L791", name: "Level 791" },
                { id: "L792", name: "Level 792" },
                { id: "L793", name: "Level 793" },
                { id: "L794", name: "Level 794" },
                { id: "L795", name: "Level 795" },
                { id: "L796", name: "Level 796" },
                { id: "L797", name: "Level 797" },
                { id: "L798", name: "Level 798" },
                { id: "L799", name: "Level 799" },
                { id: "L800", name: "Level 800" },
                { id: "L801", name: "Level 801" },
                { id: "L802", name: "Level 802" },
                { id: "L803", name: "Level 803" },
                { id: "L804", name: "Level 804" },
                { id: "L805", name: "Level 805" },
                { id: "L806", name: "Level 806" },
                { id: "L807", name: "Level 807" },
                { id: "L808", name: "Level 808" },
                { id: "L809", name: "Level 809" },
                { id: "L810", name: "Level 810" },
                { id: "L811", name: "Level 811" },
                { id: "L812", name: "Level 812" },
                { id: "L813", name: "Level 813" },
                { id: "L814", name: "Level 814" },
                { id: "L815", name: "Level 815" },
                { id: "L816", name: "Level 816" },
                { id: "L817", name: "Level 817" },
                { id: "L818", name: "Level 818" },
                { id: "L819", name: "Level 819" },
                { id: "L820", name: "Level 820" },
                { id: "L821", name: "Level 821" },
                { id: "L822", name: "Level 822" },
                { id: "L823", name: "Level 823" },
                { id: "L824", name: "Level 824" },
                { id: "L825", name: "Level 825" },
                { id: "L826", name: "Level 826" },
                { id: "L827", name: "Level 827" },
                { id: "L828", name: "Level 828" },
                { id: "L829", name: "Level 829" },
                { id: "L830", name: "Level 830" },
                { id: "L831", name: "Level 831" },
                { id: "L832", name: "Level 832" },
                { id: "L833", name: "Level 833" },
                { id: "L834", name: "Level 834" },
                { id: "L835", name: "Level 835" },
                { id: "L836", name: "Level 836" },
                { id: "L837", name: "Level 837" },
                { id: "L838", name: "Level 838" },
                { id: "L839", name: "Level 839" },
                { id: "L840", name: "Level 840" },
                { id: "L841", name: "Level 841" },
                { id: "L842", name: "Level 842" },
                { id: "L843", name: "Level 843" },
                { id: "L844", name: "Level 844" },
                { id: "L845", name: "Level 845" },
                { id: "L846", name: "Level 846" },
                { id: "L847", name: "Level 847" },
                { id: "L848", name: "Level 848" },
                { id: "L849", name: "Level 849" },
                { id: "L850", name: "Level 850" },
                { id: "L851", name: "Level 851" },
                { id: "L852", name: "Level 852" },
                { id: "L853", name: "Level 853" },
                { id: "L854", name: "Level 854" },
                { id: "L855", name: "Level 855" },
                { id: "L856", name: "Level 856" },
                { id: "L857", name: "Level 857" },
                { id: "L858", name: "Level 858" },
                { id: "L859", name: "Level 859" },
                { id: "L860", name: "Level 860" },
                { id: "L861", name: "Level 861" },
                { id: "L862", name: "Level 862" },
                { id: "L863", name: "Level 863" },
                { id: "L864", name: "Level 864" },
                { id: "L865", name: "Level 865" },
                { id: "L866", name: "Level 866" },
                { id: "L867", name: "Level 867" },
                { id: "L868", name: "Level 868" },
                { id: "L869", name: "Level 869" },
                { id: "L870", name: "Level 870" },
                { id: "L871", name: "Level 871" },
                { id: "L872", name: "Level 872" },
                { id: "L873", name: "Level 873" },
                { id: "L874", name: "Level 874" },
                { id: "L875", name: "Level 875" },
                { id: "L876", name: "Level 876" },
                { id: "L877", name: "Level 877" },
                { id: "L878", name: "Level 878" },
                { id: "L879", name: "Level 879" },
                { id: "L880", name: "Level 880" },
                { id: "L881", name: "Level 881" },
                { id: "L882", name: "Level 882" },
                { id: "L883", name: "Level 883" },
                { id: "L884", name: "Level 884" },
                { id: "L885", name: "Level 885" },
                { id: "L886", name: "Level 886" },
                { id: "L887", name: "Level 887" },
                { id: "L888", name: "Level 888" },
                { id: "L889", name: "Level 889" },
                { id: "L890", name: "Level 890" },
                { id: "L891", name: "Level 891" },
                { id: "L892", name: "Level 892" },
                { id: "L893", name: "Level 893" },
                { id: "L894", name: "Level 894" },
                { id: "L895", name: "Level 895" },
                { id: "L896", name: "Level 896" },
                { id: "L897", name: "Level 897" },
                { id: "L898", name: "Level 898" },
                { id: "L899", name: "Level 899" },
                { id: "L900", name: "Level 900" },
                { id: "L901", name: "Level 901" },
                { id: "L902", name: "Level 902" },
                { id: "L903", name: "Level 903" },
                { id: "L904", name: "Level 904" },
                { id: "L905", name: "Level 905" },
                { id: "L906", name: "Level 906" },
                { id: "L907", name: "Level 907" },
                { id: "L908", name: "Level 908" },
                { id: "L909", name: "Level 909" },
                { id: "L910", name: "Level 910" },
                { id: "L911", name: "Level 911" },
                { id: "L912", name: "Level 912" },
                { id: "L913", name: "Level 913" },
                { id: "L914", name: "Level 914" },
                { id: "L915", name: "Level 915" },
                { id: "L916", name: "Level 916" },
                { id: "L917", name: "Level 917" },
                { id: "L918", name: "Level 918" },
                { id: "L919", name: "Level 919" },
                { id: "L920", name: "Level 920" },
                { id: "L921", name: "Level 921" },
                { id: "L922", name: "Level 922" },
                { id: "L923", name: "Level 923" },
                { id: "L924", name: "Level 924" },
                { id: "L925", name: "Level 925" },
                { id: "L926", name: "Level 926" },
                { id: "L927", name: "Level 927" },
                { id: "L928", name: "Level 928" },
                { id: "L929", name: "Level 929" },
                { id: "L930", name: "Level 930" },
                { id: "L931", name: "Level 931" },
                { id: "L932", name: "Level 932" },
                { id: "L933", name: "Level 933" },
                { id: "L934", name: "Level 934" },
                { id: "L935", name: "Level 935" },
                { id: "L936", name: "Level 936" },
                { id: "L937", name: "Level 937" },
                { id: "L938", name: "Level 938" },
                { id: "L939", name: "Level 939" },
                { id: "L940", name: "Level 940" },
                { id: "L941", name: "Level 941" },
                { id: "L942", name: "Level 942" },
                { id: "L943", name: "Level 943" },
                { id: "L944", name: "Level 944" },
                { id: "L945", name: "Level 945" },
                { id: "L946", name: "Level 946" },
                { id: "L947", name: "Level 947" },
                { id: "L948", name: "Level 948" },
                { id: "L949", name: "Level 949" },
                { id: "L950", name: "Level 950" },
                { id: "L951", name: "Level 951" },
                { id: "L952", name: "Level 952" },
                { id: "L953", name: "Level 953" },
                { id: "L954", name: "Level 954" },
                { id: "L955", name: "Level 955" },
                { id: "L956", name: "Level 956" },
                { id: "L957", name: "Level 957" },
                { id: "L958", name: "Level 958" },
                { id: "L959", name: "Level 959" },
                { id: "L960", name: "Level 960" },
                { id: "L961", name: "Level 961" },
                { id: "L962", name: "Level 962" },
                { id: "L963", name: "Level 963" },
                { id: "L964", name: "Level 964" },
                { id: "L965", name: "Level 965" },
                { id: "L966", name: "Level 966" },
                { id: "L967", name: "Level 967" },
                { id: "L968", name: "Level 968" },
                { id: "L969", name: "Level 969" },
                { id: "L970", name: "Level 970" },
                { id: "L971", name: "Level 971" },
                { id: "L972", name: "Level 972" },
                { id: "L973", name: "Level 973" },
                { id: "L974", name: "Level 974" },
                { id: "L975", name: "Level 975" },
                { id: "L976", name: "Level 976" },
                { id: "L977", name: "Level 977" },
                { id: "L978", name: "Level 978" },
                { id: "L979", name: "Level 979" },
                { id: "L980", name: "Level 980" },
                { id: "L981", name: "Level 981" },
                { id: "L982", name: "Level 982" },
                { id: "L983", name: "Level 983" },
                { id: "L984", name: "Level 984" },
                { id: "L985", name: "Level 985" },
                { id: "L986", name: "Level 986" },
                { id: "L987", name: "Level 987" },
                { id: "L988", name: "Level 988" },
                { id: "L989", name: "Level 989" },
                { id: "L990", name: "Level 990" },
                { id: "L991", name: "Level 991" },
                { id: "L992", name: "Level 992" },
                { id: "L993", name: "Level 993" },
                { id: "L994", name: "Level 994" },
                { id: "L995", name: "Level 995" },
                { id: "L996", name: "Level 996" },
                { id: "L997", name: "Level 997" },
                { id: "L998", name: "Level 998" },
                { id: "L999", name: "Level 999" },
            ];

            const links = [
                { from: "Front Room", to: "L0", reason: "落下" },
                { from: "L0", to: "Front Room", reason: "落下" },
                { from: "L1", to: "L0", reason: "扉" },
                { from: "L1", to: "L2", reason: "階段" },
                { from: "L2", to: "L3", reason: "暗い通路" },
                { from: "L3", to: "L1", reason: "穴" },
                { from: "L0", to: "L7", reason: "謎解きの通路" },
                { from: "L7", to: "L9", reason: "エレベーター" }
            ];
            /* ---------------------------------------- */

            const svg = document.getElementById('svgmap');
            const tooltip = document.getElementById('tooltip');
            const linkList = document.getElementById('linkList');
            let positions = {};

            // place nodes roughly in a circle
            function computePositions(radiusX = 380, radiusY = 250) {
                const cx = 500, cy = 350;
                const n = levels.length;
                const pos = {};
                for (let i = 0; i < n; i++) {
                    const angle = (i / n) * Math.PI * 2 - Math.PI / 2;
                    pos[levels[i].id] = {
                        x: cx + Math.cos(angle) * radiusX * (0.8 + Math.random() * 0.4),
                        y: cy + Math.sin(angle) * radiusY * (0.8 + Math.random() * 0.4)
                    };
                }
                return pos;
            }

            function render() {
                svg.querySelectorAll('.edge,.node').forEach(e => e.remove());
                positions = computePositions();
                // draw edges
                links.forEach((l, i) => {
                    const a = positions[l.from], b = positions[l.to];
                    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    g.classList.add('edge');
                    g.setAttribute('data-from', l.from);
                    g.setAttribute('data-to', l.to);
                    g.setAttribute('data-reason', l.reason || '');
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    // curved path
                    const dx = b.x - a.x, dy = b.y - a.y;
                    const mx = a.x + dx * 0.5, my = a.y + dy * 0.5;
                    const cx1 = mx - dy * 0.12, cy1 = my + dx * 0.12;
                    const d = `M ${a.x} ${a.y} Q ${cx1} ${cy1} ${b.x} ${b.y}`;
                    path.setAttribute('d', d);
                    g.appendChild(path);
                    // edge hover shows reason and highlights
                    g.addEventListener('mouseenter', e => {
                        highlightEdge(l.from, l.to);
                        showEdgeTooltip(l, e);
                    });
                    g.addEventListener('mouseleave', () => {
                        if (!pinned) { clearHighlights(); hideTooltip(); }
                    });
                    svg.appendChild(g);
                });

                // draw nodes on top
                levels.forEach(lv => {
                    const p = positions[lv.id];
                    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    g.classList.add('node');
                    g.setAttribute('data-id', lv.id);
                    g.setAttribute('transform', `translate(${p.x},${p.y})`);
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('r', 34);
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', 0);
                    text.setAttribute('y', 4);
                    text.setAttribute('text-anchor', 'middle');
                    text.textContent = lv.name;
                    g.appendChild(circle);
                    g.appendChild(text);
                    svg.appendChild(g);

                    g.addEventListener('mouseenter', e => {
                        highlightNode(lv.id);
                        showTooltip(lv, e);
                    });
                    g.addEventListener('mouseleave', e => {
                        if (!pinned) { clearHighlights(); hideTooltip(); }
                    });
                    g.addEventListener('click', e => {
                        togglePin(lv.id);
                    });
                });

                populateList();
            }

            function populateList() {
                linkList.innerHTML = '';
                links.forEach(l => {
                    const li = document.createElement('li');
                    li.innerHTML = `<div>${findName(l.from)} → ${findName(l.to)}</div><div class="reason">${l.reason || ''}</div>`;
                    li.addEventListener('mouseenter', (e) => {
                        highlightEdge(l.from, l.to);
                        showEdgeTooltip(l, e);
                    });
                    li.addEventListener('mouseleave', () => {
                        if (!pinned) { clearHighlights(); hideTooltip(); }
                    });
                    li.addEventListener('click', () => {
                        // pin when clicked from list
                        pinned = `${l.from}→${l.to}`;
                        highlightEdge(l.from, l.to);
                        // show tooltip near the list item
                        showEdgeTooltip(l, { clientX: linkList.getBoundingClientRect().left + 8, clientY: li.getBoundingClientRect().top + 8 });
                    });
                    linkList.appendChild(li);
                });
            }

            function findName(id) { const it = levels.find(x => x.id === id); return it ? it.name : id }

            function highlightNode(id) {
                clearHighlights();
                // highlight node
                const node = svg.querySelector(`.node[data-id="${id}"]`);
                if (node) node.classList.add('highlight');
                // highlight outgoing edges
                svg.querySelectorAll(`.edge[data-from="${id}"]`).forEach(e => e.classList.add('highlight'));
                // highlight incoming edges
                svg.querySelectorAll(`.edge[data-to="${id}"]`).forEach(e => {
                    e.classList.add('highlight');
                    // also highlight source node
                    const from = e.getAttribute('data-from');
                    const src = svg.querySelector(`.node[data-id="${from}"]`);
                    if (src) src.classList.add('highlight');
                });
            }

            function highlightEdge(from, to) {
                clearHighlights();
                svg.querySelectorAll(`.edge[data-from="${from}"][data-to="${to}"]`).forEach(e => e.classList.add('highlight'));
                const n1 = svg.querySelector(`.node[data-id="${from}"]`);
                const n2 = svg.querySelector(`.node[data-id="${to}"]`);
                if (n1) n1.classList.add('highlight');
                if (n2) n2.classList.add('highlight');
            }

            function clearHighlights() {
                svg.querySelectorAll('.edge.highlight').forEach(e => e.classList.remove('highlight'));
                svg.querySelectorAll('.node.highlight').forEach(n => n.classList.remove('highlight'));
            }

            function showTooltip(lv, event) {
                tooltip.style.display = 'block';
                // build html with reasons
                const outs = links.filter(x => x.from === lv.id).map(x => `${findName(x.to)} (${x.reason || ''})`);
                const ins = links.filter(x => x.to === lv.id).map(x => `${findName(x.from)} (${x.reason || ''})`);
                let html = `<strong>${lv.name}</strong> <small>(${lv.id})</small><br/>`;
                if (outs.length) html += `→ ${outs.join(', ')}<br/>`;
                if (ins.length) html += `← ${ins.join(', ')}<br/>`;
                tooltip.innerHTML = html;
                const rect = svg.getBoundingClientRect();
                const ev = event.clientX !== undefined ? event : { clientX: event.x, clientY: event.y };
                tooltip.style.left = (ev.clientX - rect.left) + "px";
                tooltip.style.top = (ev.clientY - rect.top - 12) + "px";
            }

            function showEdgeTooltip(link, event) {
                tooltip.style.display = 'block';
                tooltip.innerHTML = `<strong>${findName(link.from)} → ${findName(link.to)}</strong><br/><span class="reason">${link.reason || '（理由なし）'}</span>`;
                const rect = svg.getBoundingClientRect();
                const ev = event.clientX !== undefined ? event : { clientX: event.x, clientY: event.y };
                tooltip.style.left = (ev.clientX - rect.left) + "px";
                tooltip.style.top = (ev.clientY - rect.top - 12) + "px";
            }

            function hideTooltip() { tooltip.style.display = 'none' }

            let pinned = null;
            function togglePin(id) {
                if (pinned === id) { pinned = null; clearHighlights(); hideTooltip(); return; }
                pinned = id;
                highlightNode(id);
            }

            // buttons
            document.getElementById('shuffle').addEventListener('click', () => {
                positions = computePositions();
                render();
            });
            document.getElementById('reset').addEventListener('click', () => {
                pinned = null; clearHighlights(); hideTooltip();
            });

            /* initial render */
            render();

            /* Optional: allow editing via console:
                 levels.push({id:"L10", name:"Level 10"});
                 links.push({from:"L3", to:"L10", reason:"入口"});
                 render();
            */
        </script>
    </body>

</html>
